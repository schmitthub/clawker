# Test exec command into running container
# Verifies: exec runs command in container and returns output

# Substitute project name in config
replace clawker.yaml PROJECT=$PROJECT

# Create settings directory
mkdir $HOME/.local/clawker

# Register cleanup
defer clawker container rm --force --agent exec-$RANDOM_STRING
defer clawker container stop --agent exec-$RANDOM_STRING

# Start a container
exec clawker container run --detach --agent exec-$RANDOM_STRING alpine:latest sleep 3600
wait_container_running clawker.$PROJECT.exec-$RANDOM_STRING 30

# Exec a command
exec clawker container exec --agent exec-$RANDOM_STRING echo hello-from-exec
stdout 'hello-from-exec'

# Exec with multiple arguments
exec clawker container exec --agent exec-$RANDOM_STRING cat /etc/os-release
stdout 'Alpine'

-- clawker.yaml --
version: "1"
project: "$PROJECT"

build:
  image: "alpine:latest"

security:
  firewall:
    enable: false
