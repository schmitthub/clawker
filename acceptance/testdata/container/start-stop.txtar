# Test container start and stop lifecycle
# Verifies: create, start, stop, restart workflow

# Register cleanup
defer clawker container rm --force --agent lifecycle-$RANDOM_STRING

# Create container (doesn't start it)
exec clawker container create --agent lifecycle-$RANDOM_STRING alpine:latest sleep 3600

# Verify container exists but is not running
exec clawker container ls -a
stdout 'lifecycle-'$RANDOM_STRING
exec clawker container ls
! stdout 'lifecycle-'$RANDOM_STRING

# Start the container
exec clawker container start --agent lifecycle-$RANDOM_STRING
wait_container_running clawker.$PROJECT.lifecycle-$RANDOM_STRING 30

# Verify it's now running
exec clawker container ls
stdout 'lifecycle-'$RANDOM_STRING

# Stop the container
exec clawker container stop --agent lifecycle-$RANDOM_STRING

# Verify it's stopped (in -a list but not running list)
exec clawker container ls
! stdout 'lifecycle-'$RANDOM_STRING
exec clawker container ls -a
stdout 'lifecycle-'$RANDOM_STRING

# Restart should start it again
exec clawker container restart --agent lifecycle-$RANDOM_STRING
wait_container_running clawker.$PROJECT.lifecycle-$RANDOM_STRING 30

exec clawker container ls
stdout 'lifecycle-'$RANDOM_STRING

-- clawker.yaml --
version: "1"

build:
  image: "alpine:latest"

security:
  firewall:
    enable: false
