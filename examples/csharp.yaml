# C# / .NET Project Build Configuration
#
# This example sets up .NET SDK using Microsoft's official package repository.
# Includes the full SDK for building, running, and testing .NET applications.

build:
  # Base image - Debian bookworm with build essentials
  image: "buildpack-deps:bookworm-scm"

  # System packages
  packages:
    - git
    - curl
    - ripgrep
    - ca-certificates
    - wget

  instructions:
    # Environment variables for .NET
    env:
      DOTNET_ROOT: "/usr/share/dotnet"
      DOTNET_CLI_TELEMETRY_OPTOUT: "1"
      DOTNET_NOLOGO: "1"

    # Install .NET SDK as root (system-wide)
    root_run:
      # Add Microsoft package repository and install .NET SDK
      - cmd: |
          wget https://packages.microsoft.com/config/debian/12/packages-microsoft-prod.deb -O packages-microsoft-prod.deb && \
          dpkg -i packages-microsoft-prod.deb && \
          rm packages-microsoft-prod.deb && \
          apt-get update && \
          apt-get install -y dotnet-sdk-8.0

    # Configure .NET for the claude user
    user_run:
      # Add dotnet tools to PATH
      - cmd: |
          echo 'export PATH="$HOME/.dotnet/tools:$PATH"' >> ~/.bashrc

      # Install common .NET tools
      - cmd: |
          dotnet tool install --global dotnet-format && \
          dotnet tool install --global dotnet-ef

# Alternative: Use the official .NET SDK image as base
# Simpler and ensures you get a properly configured environment:
#
# build:
#   image: "mcr.microsoft.com/dotnet/sdk:8.0-bookworm-slim"
#   packages:
#     - git
#     - ripgrep
#   instructions:
#     user_run:
#       - cmd: |
#           dotnet tool install --global dotnet-format
