# Python Project Build Configuration
#
# This example sets up Python using uv - the fast Python package manager and installer.
# uv handles both Python version management and package installation.

build:
  # Base image - Debian bookworm with build essentials
  image: "buildpack-deps:bookworm-scm"

  # System packages needed for Python compilation
  packages:
    - git
    - curl
    - ripgrep
    - ca-certificates
    - libssl-dev
    - zlib1g-dev
    - libbz2-dev
    - libreadline-dev
    - libsqlite3-dev
    - libncursesw5-dev
    - xz-utils
    - tk-dev
    - libxml2-dev
    - libxmlsec1-dev
    - libffi-dev
    - liblzma-dev

  instructions:
    # Environment variables for Python
    env:
      UV_PYTHON_PREFERENCE: "managed"
      PYTHON_VERSION: "3.12"

    # Install uv and Python as the claude user
    user_run:
      # Install uv (fast Python package manager)
      - cmd: |
          curl -LsSf https://astral.sh/uv/install.sh | sh

      # Add uv to PATH and install Python
      - cmd: |
          export PATH="$HOME/.local/bin:$PATH" && \
          uv python install $PYTHON_VERSION

      # Add uv to shell profile
      - cmd: |
          echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc

# Alternative: Use pyenv for Python version management
# This approach is more traditional but slower than uv:
#
# build:
#   image: "buildpack-deps:bookworm-scm"
#   packages:
#     - git
#     - curl
#     - ripgrep
#     - [... same build deps as above ...]
#   instructions:
#     env:
#       PYENV_ROOT: "/home/claude/.pyenv"
#       PYTHON_VERSION: "3.12"
#     user_run:
#       - cmd: |
#           curl https://pyenv.run | bash
#       - cmd: |
#           export PATH="$PYENV_ROOT/bin:$PATH" && \
#           eval "$(pyenv init -)" && \
#           pyenv install $PYTHON_VERSION && \
#           pyenv global $PYTHON_VERSION
#       - cmd: |
#           echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc && \
#           echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc && \
#           echo 'eval "$(pyenv init -)"' >> ~/.bashrc
