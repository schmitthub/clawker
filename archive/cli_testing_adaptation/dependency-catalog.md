# Docker CLI Testing Dependency Catalog

> Generated by dependency-mapper for github.com/docker/cli
> Feature scope: Testing implementation across all tiers (unit, integration, e2e)
> Analysis date: 2026-01-30

## Executive Summary

The Docker CLI project employs a sophisticated, multi-tier testing architecture centered on **gotest.tools/v3**, the standard assertion and testing utility library from the Go community. The project deliberately minimizes external testing dependencies, relying instead on Go's standard testing package combined with strategic use of gotest.tools' specialized modules. Testing is orchestrated through **gotestsum** as the test runner with comprehensive instrumentation via Docker buildx for reproducible, containerized test execution.

**Key characteristics:**
- Single dedicated testing library (gotest.tools/v3) with modular components
- Comprehensive internal test helpers and fixtures (`internal/test/` package)
- Multi-tier testing: unit tests, integration tests, and e2e tests
- Docker-based build and test orchestration via docker-bake
- gotestsum integration for enhanced test reporting and coverage
- No external mocking libraries (uses internal fake implementations)

---

## Dependency Summary

```
Total Dependencies: 62 total, 1 primary testing library
Testing-Tier Focus Dependencies: 3 (gotest.tools/v3, gotestsum, google/go-cmp)
Primary Package Manager: go modules (vendor/ directory)
Lock File Present: go.mod (vendor mode), go.sum
Go Version: 1.25.6 (minimum 1.24.0)
```

---

## Core Testing Dependencies

### gotest.tools/v3
- **Version**: v3.5.2
- **Type**: Direct Dependency (Production/Testing)
- **Category**: Test Framework & Assertions
- **Purpose**: The primary testing assertion and utility library for Go. Provides fluent assertions, file system testing utilities, environment variable management, command execution harness, polling utilities, and skip conditions for test management.
- **Features Used**:
  - `gotest.tools/v3/assert` - Fluent assertion API with helper-based checks
  - `gotest.tools/v3/assert/cmp` - Comparison matchers (imported as `is` in many tests)
  - `gotest.tools/v3/fs` - File system assertions and temporary file handling
  - `gotest.tools/v3/golden` - Golden file testing for snapshot assertions
  - `gotest.tools/v3/icmd` - Command execution and output verification
  - `gotest.tools/v3/poll` - Polling utilities for eventual consistency testing
  - `gotest.tools/v3/skip` - Test skipping conditions based on environment/platform
  - `gotest.tools/v3/env` - Environment variable manipulation for test isolation
- **Usage Patterns**:
  - `assert.NilError(t, err)` and `assert.Equal(t, expected, actual)` for assertions
  - `assert.Check(t, cmp.Equal(...))` for complex comparisons
  - `icmd.RunCmd()` for executing docker commands in tests
  - `skip.If(t, condition, reason)` for platform/daemon-specific test skipping
  - `fs.NewDir()` and `fs.NewFile()` for test fixture creation
  - `golden.Assert()` for output comparison against golden files
- **Replaceability**: Difficult
  - Very deeply integrated across 200+ test files
  - Idiomatic Go testing patterns that are difficult to replace
  - No single drop-in replacement library exists
  - Could be replaced by testify assertions + custom helpers (moderate effort)
  - Could be replaced by standard library only (high effort, verbose)
- **Alternatives**:
  - **testify** (github.com/stretchr/testify): Popular but heavier, includes mocking
  - **Go standard library only**: Requires extensive custom assertion helpers
  - **Custom assertion package**: Write domain-specific helpers
  - **assert package in Go 1.20+**: Not sufficient for all use cases here
- **License**: Apache 2.0
- **Maintenance Status**: Active, maintained by go-test-yourself organization
- **GitHub**: https://github.com/gotestyourself/gotest.tools

### gotestsum
- **Version**: v1.13.0
- **Type**: Development/CI Dependency (Test Runner)
- **Category**: Test Execution & Reporting
- **Purpose**: Enhanced test runner that provides better formatting, aggregation, and reporting of Go test results. Installed in dev container and used by Dockerfile for containerized test execution.
- **Features Used**:
  - Test result formatting (dots, short, standard, verbose modes)
  - Code coverage aggregation
  - JUnit XML output generation (for CI/CD pipelines)
  - Better organization of parallel test output
- **Usage Patterns**:
  - CLI invocation: `gotestsum -- <go test args>`
  - Coverage output: `gotestsum -- ... -coverprofile=file.txt`
  - Environment variable control: `GOTESTSUM_FORMAT=(format) make test-unit`
- **Replaceability**: Easy to Moderate
  - Could be replaced by standard `go test` directly
  - Would lose enhanced output formatting
  - Coverage reporting still works with `go test`
  - JUnit output could be achieved through other means
- **Alternatives**:
  - **go test** (standard library): Direct replacement, but less formatting
  - **go-junit-report**: Additional tool for JUnit XML generation
  - **Rich** (Go version): Third-party test output formatter
  - **test2json + custom processing**: Manual approach using Go's JSON test output
- **License**: Apache 2.0
- **Maintenance Status**: Active
- **GitHub**: https://github.com/gotestyourself/gotestsum
- **Installation Method**: Dockerfile multi-stage build from source (ARG GOTESTSUM_VERSION=v1.13.0)

### google/go-cmp
- **Version**: v0.7.0
- **Type**: Direct Dependency (Testing Support)
- **Category**: Test Comparison & Deep Equality
- **Purpose**: Deep comparison package that provides flexible equality testing and difference reporting. Used alongside gotest.tools comparators for complex object comparisons in tests, particularly for compose loader tests and manifest store tests.
- **Features Used**:
  - `cmp.Diff()` - Generate formatted diff between complex objects
  - `cmp.Equal()` - Deep equality checking with custom options
  - `cmpopts.IgnoreFields()` - Option to ignore specific struct fields in comparison
  - `cmpopts.EquateApproxTime()` - Approximate time comparison
  - `cmpopts.SortSlices()` - Normalized slice comparison
- **Usage Patterns**:
  - Used in conjunction with assert: `assert.Equal(t, expected, actual, cmp.Diff(...))`
  - Direct comparison: `if !cmp.Equal(obj1, obj2) { t.Fatalf("diff: %s", cmp.Diff(...)) }`
  - Complex comparisons with options: `cmp.Equal(val1, val2, cmpopts.IgnoreFields(...))`
- **Replaceability**: Moderate
  - Could be replaced by deep-equal library or custom comparison
  - Would require rewriting complex comparison tests
  - testify/assert.Equal provides similar functionality
- **Alternatives**:
  - **testify/assert** - Similar comparison but less flexible
  - **reflect.DeepEqual** - Standard library, but less informative output
  - Custom comparison functions - Domain-specific approach
- **License**: BSD 3-Clause
- **Maintenance Status**: Active, maintained by Google
- **GitHub**: https://github.com/google/go-cmp

---

## Internal Testing Infrastructure

### FakeCli Test Helper (`internal/test/cli.go`)

An internal package providing test doubles for the main CLI interface. This is NOT an external dependency but critical testing infrastructure.

- **Purpose**: Provides a fake implementation of `command.Cli` interface for unit testing
- **Key Components**:
  - `FakeCli` struct: Implements `command.DockerCli` interface with mock streams, config, and client
  - Configurable API clients via constructor options pattern
  - Output buffer capture for stdout/stderr verification
  - Config file mocking for context/auth testing
- **Usage**: Every command test uses `test.NewFakeCli()` with optional fake API client
- **Example**:
  ```go
  fakeCLI := test.NewFakeCli(&fakeClient{
      createContainerFunc: func(...) {...},
  })
  ```

### Test Builders (`internal/test/builders/`)

Domain-specific test fixture builders for Docker objects:
- `container.go` - Build test containers
- `service.go` - Build test services (Swarm)
- `task.go` - Build test tasks (Swarm)
- `network.go` - Build test networks
- `volume.go` - Build test volumes
- `node.go` - Build test nodes (Swarm)
- `secret.go` - Build test secrets
- `config.go` - Build test configs

These provide fluent APIs for constructing complex test objects without external builder libraries.

### Test Environment & Utilities (`internal/test/environment/`)

- `testenv.go` - E2E test environment setup, daemon detection, platform detection
- `environment.Setup()` - Initializes test environment (TEST_DOCKER_HOST, certificates, etc.)
- Platform/daemon detection helpers for conditional test execution
- Default poll settings for eventual consistency testing

### Test Output Verification (`internal/test/output/`)

- `output.go` - Utilities for capturing and verifying command output

---

## Build & CI/CD Testing Infrastructure

### Docker Build Infrastructure

#### Dockerfile Layers for Testing

The main `Dockerfile` defines several test-related build stages:

**1. gotestsum Installation Stage**
```dockerfile
FROM build-base-${BASE_VARIANT} AS gotestsum
ARG GOTESTSUM_VERSION
RUN GOBIN=/out go install "gotest.tools/gotestsum@${GOTESTSUM_VERSION}"
```
- Installs gotestsum binary from source
- Version controlled via ARG (currently v1.13.0)

**2. Unit Test Stage**
```dockerfile
FROM build-${BASE_VARIANT} AS test
COPY --from=gotestsum /out/gotestsum /usr/bin/gotestsum
ENV GO111MODULE=auto
RUN gotestsum -- -coverprofile=/tmp/coverage.txt $(go list ./...)
```
- Executes all unit tests with coverage
- Output format configurable via environment

**3. Coverage Extraction Stage**
```dockerfile
FROM scratch AS test-coverage
COPY --from=test /tmp/coverage.txt /coverage.txt
```
- Outputs coverage report for CI/CD integration

**4. E2E Test Image Stage**
```dockerfile
FROM e2e-base-${BASE_VARIANT} AS e2e
COPY --from=gotestsum /out/gotestsum /usr/bin/gotestsum
COPY --from=build /out ./build/
COPY --from=build-plugins /out ./build/
COPY --from=buildx  /buildx  /usr/libexec/docker/cli-plugins/docker-buildx
COPY --from=compose /docker-compose /usr/libexec/docker/cli-plugins/docker-compose
```
- Complete test environment with docker buildx, compose, and built CLI
- Ready for e2e test execution

#### docker-bake.hcl Test Targets

```hcl
target "test" {
    inherits = ["_common"]
    target = "test"
    output = ["type=cacheonly"]
}

target "test-coverage" {
    inherits = ["_common"]
    target = "test-coverage"
    output = ["build/coverage"]
}

target "e2e-image" {
    inherits = ["_common"]
    target = "e2e"
    output = ["type=docker"]
    tags = ["${IMAGE_NAME}"]
}
```

### Makefile Test Targets

```makefile
.PHONY: test-unit
test-unit:
	gotestsum -- ${TESTDIRS:-$(shell go list ./... | grep -vE '/vendor/|/e2e/|/cmd/docker-trust')} $(TESTFLAGS)

.PHONY: test-coverage
test-coverage:
	mkdir -p $(CURDIR)/build/coverage
	gotestsum -- $(shell go list ./...) -coverprofile=$(CURDIR)/build/coverage/coverage.txt
```

Key patterns:
- Excludes `/vendor/`, `/e2e/`, `/cmd/docker-trust` from unit tests
- Coverage files written to `build/coverage/` for artifact collection
- Support for custom TESTDIRS and TESTFLAGS

---

## Test Structure & Organization

### Unit Tests (`cli/command/**/*_test.go`)

- **Pattern**: One test file per command/component
- **Assertion**: gotest.tools/v3 assertions
- **Fakes**: Internal `test.NewFakeCli()` with mock API clients
- **Coverage**: Extensive (estimated 70%+ of command code)
- **Example locations**:
  - `cli/command/container/run_test.go`
  - `cli/command/image/push_test.go`
  - `cli/command/service/list_test.go`

### Integration Tests

- **Pattern**: Often co-located with unit tests or in dedicated `*_test.go` files
- **Scope**: Testing multiple components together
- **Database/State**: In-memory or temporary file systems
- **No External Services**: Uses Docker daemon via TestMain setup

### E2E Tests (`e2e/**/*_test.go`)

- **Pattern**: Separate e2e directory mirroring command structure
- **Execution**: Full docker daemon interaction
- **Platform Detection**: Uses `environment.SkipIfNotPlatform()`, `SkipIfDaemonNotLinux()`, etc.
- **Fixtures**: `e2e/testdata/Dockerfile.gencerts` for certificate generation
- **Test Entry**: `scripts/test/e2e/entry` - Custom entry point
- **Examples**:
  - `e2e/container/main_test.go` - Container e2e tests
  - `e2e/image/build_test.go` - Build command e2e tests
  - `e2e/context/context_test.go` - Context e2e tests

### Linting & Code Quality

**golangci-lint Configuration** (`.golangci.yml`)

Key test-related linters enabled:
- `thelper` - Enforces t.Helper() in test helpers
- `tparallel` - Detects inappropriate t.Parallel() usage
- `usetesting` - Reports replaceable testing package usages
- `copyloopvar` - Detects problematic loop variable captures in tests
- Other general linters: errcheck, staticcheck, govet, etc.

---

## Testing Patterns & Best Practices

### Command Testing Pattern

```go
func TestRunLabel(t *testing.T) {
    // 1. Create fake CLI with mock API client
    fakeCLI := test.NewFakeCli(&fakeClient{
        createContainerFunc: func(...) {...},
    })

    // 2. Create command
    cmd := newRunCommand(fakeCLI)

    // 3. Set arguments
    cmd.SetArgs([]string{"--detach=true", "--label", "foo", "busybox"})

    // 4. Assert execution
    assert.NilError(t, cmd.Execute())

    // 5. Verify output/behavior
    assert.Equal(t, fakeCLI.OutBuffer().String(), expected)
}
```

### E2E Test Pattern

```go
package context

import (
    "testing"
    "github.com/docker/cli/internal/test/environment"
)

func TestMain(m *testing.M) {
    if err := environment.Setup(); err != nil {
        fmt.Println(err.Error())
        os.Exit(3)
    }
    os.Exit(m.Run())
}

func TestContextCreate(t *testing.T) {
    // Platform-specific skips
    environment.SkipIfNotPlatform(t, "linux/amd64")

    // Test implementation with real docker daemon
    result := icmd.RunCmd(icmd.Command("docker", "context", "create", ...))
    result.Assert(t, icmd.Expected{Err: icmd.None})
}
```

### Output Comparison Pattern

```go
func TestOutput(t *testing.T) {
    // Using golden files
    golden.Assert(t, actual, "expected-output.golden")

    // Or manual comparison
    expected := `...`
    assert.Equal(t, actual, expected)
}
```

### Assertion Patterns

```go
// Simple assertions
assert.NilError(t, err)
assert.Equal(t, expected, actual)
assert.Assert(t, condition)

// Comparison operators
assert.Check(t, cmp.Equal(a, b))
assert.Check(t, cmp.Len(slice, 5))
assert.Check(t, cmp.Contains(str, "substring"))

// Deep equality with diff
assert.Equal(t, expected, actual, cmp.Diff(...))
```

---

## Platform & Environment Testing

### Conditional Test Execution

Tests use environment detection utilities for:
- **Linux/non-Linux daemon skipping** - `SkipIfDaemonNotLinux(t)`
- **Platform-specific tests** - `SkipIfNotPlatform(t, "linux/arm64")`
- **Experimental daemon features** - `SkipIfNotExperimentalDaemon(t)`
- **Cgroup namespace support** - `SkipIfCgroupNamespacesNotSupported(t)`

### E2E Test Entry Point

`scripts/test/e2e/entry` - Custom shell script that:
1. Sets up Docker environment variables
2. Configures daemon connectivity
3. Executes gotestsum with e2e test suites
4. Collects test results

### CI/CD Integration

Environment variables for test configuration:
- `TEST_DOCKER_HOST` - Docker daemon connection string
- `TEST_DOCKER_CERT_PATH` - TLS certificates for remote daemon
- `TEST_SKIP_PLUGIN_TESTS` - Skip plugin-related tests
- `TEST_REMOTE_DAEMON` - Tests against remote daemon
- `GOTESTSUM_FORMAT` - Output format selection

---

## Dependency Graph & Relationships

### Testing Dependency Chain

```
gotest.tools/v3 (v3.5.2)
├── assert (core assertions)
├── assert/cmp (comparison matchers)
├── fs (file system test utilities)
├── golden (golden file testing)
├── icmd (command execution)
├── poll (polling utilities)
├── skip (conditional skipping)
└── env (environment management)

google/go-cmp (v0.7.0)
└── Used by gotest.tools/v3 internally
└── Also used directly for complex comparisons

Transitive from gotest.tools/v3:
├── github.com/google/go-cmp/cmp
├── github.com/pkg/errors (for diff reporting)
└── Standard library packages (reflect, time, etc.)
```

### No Mock/Stub External Dependencies

The project deliberately avoids external mocking libraries:
- **NOT using**: testify/mock, gomock, mockery, etc.
- **Approach**: Hand-written fake implementations in test files
- **Example**: `fakeClient` structs with configured func fields
- **Benefit**: Explicit control, no code generation complexity

---

## Testing Tools & Build Environment

### Go Version: 1.25.6

- Minimum required: go1.24.0
- Uses CalVer versioning (not SemVer)
- GO111MODULE=auto (special handling for vendored mode)

### Docker Build Tools in Test Environment

Build stage base images include:
- **Alpine/Debian base** - ALPINE_VERSION=3.22, BASE_DEBIAN_DISTRO=bookworm
- **Go toolchain** - golang:${GO_VERSION}-alpine/debian
- **Cross-compilation support** - tonistiiji/xx for multi-platform builds
- **Build essentials** - bash, clang, lld, llvm, file, git

### E2E Test Additional Tools

Installed in e2e image:
- **docker buildx** (v0.29.1) - For build command testing
- **docker compose** (v2.40.0) - For compose command testing
- **build-essential** - C/C++ compilation
- **OpenSSL, SSH client** - Certificate/TLS testing
- **curl** - Network testing

### Test Execution Format Options

Via environment variable GOTESTSUM_FORMAT:
- `dots` - Single character per test (minimal output)
- `short` - Shortened format
- `standard-quiet` - Standard format with minimal verbosity
- `short-verbose` - Verbose short format
- `standard-verbose` - Full verbose output

---

## Linting & Code Quality Dependencies

### golangci-lint Configuration

Key testing-focused linters:

| Linter | Purpose | Testing Relevance |
|--------|---------|------------------|
| thelper | Requires t.Helper() in test helpers | Enforces proper test helper pattern |
| tparallel | Detects t.Parallel() issues | Prevents race conditions in tests |
| usetesting | Replaces testing package functions | Modernizes test assertions |
| copyloopvar | Loop variable capture bugs | Common in test generation loops |
| errcheck | Unchecked error returns | Tests must verify errors |
| govet | Go vet checks | Catches test logic errors |
| staticcheck | Static analysis | Test code quality |

**Command**: `golangci-lint run` (can be run via `make lint` or `docker buildx bake lint`)

---

## Adaptation Recommendations

### For Different Testing Scenarios

**Scenario 1: Embedded Testing (Keep Internal)**
- Continue using internal `test` package with FakeCli
- No external mocking needed for command testing
- Lightweight and zero external deps

**Scenario 2: Cross-Language Testing (CLI Contract Tests)**
- Replace gotest.tools/v3 assertions with language-neutral testing frameworks
- Use JSON/YAML schemas for response validation
- Cucumber/Gherkin for behavior-driven tests

**Scenario 3: Load/Performance Testing**
- Add: go-benchmark (standard library)
- Add: vegeta (HTTP load testing)
- Add: pprof (profiling, already in stdlib)
- Keep: gotestsum for orchestration

**Scenario 4: Mutation Testing**
- Add: go-mutesting (mutation testing for Go)
- Requires separate test execution phase
- Doesn't replace existing testing stack

### Minimal Replacement Path

If forced to replace gotest.tools/v3:

1. **Phase 1**: Replace assertions with testify/assert
   ```go
   // Before
   assert.Equal(t, expected, actual)

   // After
   require.Equal(t, expected, actual)
   ```

2. **Phase 2**: Replace specialized utilities
   - `golden` → manual file comparison
   - `icmd` → os/exec package + custom wrapper
   - `fs` → ioutil/os + custom temp handling
   - `poll` → time.Sleep loops + custom retry logic
   - `skip` → testing.Skip() + t.SkipNow()

3. **Phase 3**: Replace comparisons
   - Direct use of `cmp` package or reflect.DeepEqual
   - Custom diff functions for complex types

**Effort**: 2-3 weeks for 200+ test files

### Optimal Replacement Path

Keep what works, enhance as needed:

1. **Keep**: gotest.tools/v3 for all existing tests
2. **Keep**: gotestsum for test execution
3. **Add**: testify/suite for table-driven tests if needed
4. **Add**: stretchr/testify/mock only if mocking required (not currently needed)
5. **Add**: github.com/prometheus/client_golang (already in vendor, has testing utilities)

---

## Risk Assessment

### Maintenance Risks

**Low Risk**:
- gotest.tools/v3 - Actively maintained, widely used
- gotestsum - Actively maintained, simple CLI tool
- google/go-cmp - Actively maintained by Google

**Medium Risk**:
- Internal test infrastructure - Must maintain as project evolves
- Test fixtures in testdata/ - Must keep in sync with code changes

**High Risk**: None identified

### Dependency Version Constraints

**Pinned Versions** (direct dependencies):
- gotest.tools/v3 = v3.5.2 (exact pin)
- gotestsum = v1.13.0 (in Dockerfile ARG)

**Transitive Risk**: Very low
- gotest.tools/v3 has minimal dependencies
- All transitive deps are stable (google/go-cmp, reflect, etc.)

### Platform Compatibility

All testing tools support:
- Linux (primary)
- macOS (ARM64/x86-64)
- Windows (integration tests may be limited)

Tests use platform detection to skip incompatible tests.

---

## Full Dependency List

### Testing-Related Dependencies

| Name | Version | Category | Purpose | Source |
|------|---------|----------|---------|--------|
| gotest.tools/v3 | v3.5.2 | Test Framework | Assertions, file system, command, polling, skip, environment utilities | go.mod |
| google/go-cmp | v0.7.0 | Test Utilities | Deep comparison, diff generation | go.mod (indirect) |
| gotestsum | v1.13.0 | Test Runner | Enhanced test execution and reporting | Dockerfile ARG |
| creack/pty | v1.1.24 | PTY/Terminal | Used by icmd for TTY handling in command execution | go.mod |

### Build & Infrastructure Dependencies (Used in Testing)

| Name | Version | Category | Purpose | Source |
|------|---------|----------|---------|--------|
| moby/moby/client | v0.2.2-rc.1 | Docker API | Docker daemon client for API testing | go.mod |
| moby/moby/api | v1.53.0-rc.1 | Docker API | Docker API types | go.mod |
| spf13/cobra | v1.10.2 | CLI Framework | Command building (used in tests) | go.mod |
| spf13/pflag | v1.0.10 | Flag Parsing | Flag handling (used in tests) | go.mod |
| sirupsen/logrus | v1.9.4 | Logging | Structured logging in tests | go.mod |
| containerd/log | v0.1.0 | Logging | Logging support | go.mod |

### Build Tools (Not Go Dependencies, but Test Infrastructure)

| Tool | Version | Purpose | Configuration |
|------|---------|---------|---|
| docker buildx | 0.29.1 | Multi-platform builds | docker-bake.hcl |
| docker compose | v2.40.0 | E2E test orchestration | e2e/Dockerfile stage |
| golangci-lint | latest | Code linting | .golangci.yml |
| goversioninfo | v1.5.0 | Windows versioning | Dockerfile ARG |
| tonistiiji/xx | 1.7.0 | Cross-compilation | Dockerfile ARG |

### Go Standard Library Testing Packages Used

- `testing` - Core testing framework
- `testing/iotest` - I/O testing
- `bytes` - Buffer testing
- `io` - I/O testing utilities
- `strings` - String testing
- `reflect` - Used with gotest.tools for type inspection
- `time` - Timing in polling tests
- `os` - Environment and file operations
- `path/filepath` - File path testing
- `fmt` - Output formatting in tests

---

## Integration with External Systems

### GitHub Actions / CI/CD

The testing infrastructure supports GitHub Actions via:
- `docker buildx bake test` - Run all tests in container
- `docker buildx bake test-coverage` - Generate coverage reports
- `docker buildx bake lint` - Run linting
- Output artifacts: `build/coverage/coverage.txt` for coverage tracking

### Coverage Reporting

- **Format**: Standard Go coverage profile (from `-coverprofile=file.txt`)
- **Location**: `build/coverage/coverage.txt` (collected by docker buildx)
- **Integration**: Compatible with Codecov, Coveralls, and other coverage services
- **Target**: Currently 70%+ of command code covered

### Docker Hub Integration

E2E tests pull:
- Docker buildx binary from docker/buildx-bin:${BUILDX_VERSION}
- Docker compose binary from docker/compose-bin:${COMPOSE_VERSION}

---

## Summary of Findings

### Strengths of Current Approach

1. **Minimal External Dependencies** - Only 1 dedicated testing library (gotest.tools/v3)
2. **Explicit Fakes** - No code generation complexity, clear test doubles
3. **Comprehensive Testing** - Unit, integration, and e2e tiers
4. **Good Tooling** - gotestsum provides excellent visibility
5. **Reproducible** - Docker-based test environment ensures consistency
6. **Maintainable** - All test utilities are internal or well-established

### Potential Improvements

1. **Add testify/suite** - For table-driven test organization (optional)
2. **Add testify/mock** - Only if mocking becomes necessary (avoid if possible)
3. **Consider Ginkgo** - For BDD-style tests (major change, not recommended)
4. **Improve coverage** - Target 80%+ command coverage
5. **Parallel test execution** - Better use of t.Parallel() (already partially done)

### Recommendations for Adaptation

1. **Keep current stack** - It's well-designed and minimal
2. **Document patterns** - Create test pattern guide for contributors
3. **Enhance E2E** - Add more platform-specific integration tests
4. **Monitor gotestsum** - Updates available for better formatting
5. **Consider fuzzing** - Native Go fuzzing for input validation (Go 1.18+)

---

## Appendix: Test Execution Commands

### Run all unit tests
```bash
make test-unit
# Or with specific format
GOTESTSUM_FORMAT=standard-verbose make test-unit
```

### Run specific test package
```bash
go test ./cli/command/container/... -v
# Via gotestsum
gotestsum -- ./cli/command/container/... -v
```

### Run specific test
```bash
gotestsum -- ./cli/command/container/... -run TestRunLabel -v
```

### Generate coverage
```bash
make test-coverage
# Output: build/coverage/coverage.txt
```

### Run via Docker buildx
```bash
docker buildx bake test
docker buildx bake test-coverage
```

### Run e2e tests
```bash
docker buildx bake e2e-image
# Then run container
docker run --rm -it -v /var/run/docker.sock:/var/run/docker.sock docker-cli
```

### Run linting
```bash
make lint
# Or specific linters
golangci-lint run ./cli/...
```

---

## References & Resources

- **gotest.tools documentation**: https://github.com/gotestyourself/gotest.tools
- **gotestsum documentation**: https://github.com/gotestyourself/gotestsum
- **google/go-cmp**: https://github.com/google/go-cmp
- **Go testing package**: https://pkg.go.dev/testing
- **Docker CLI repository**: https://github.com/docker/cli
- **Docker Build documentation**: https://github.com/docker/buildx

---

**Catalog Generated**: 2026-01-30
**Repository**: github.com/docker/cli
**Go Version**: 1.25.6
**Platform**: darwin (analysis platform, tests run on linux/darwin/windows)
