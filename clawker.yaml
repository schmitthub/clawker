# Clawker Configuration
# Documentation: https://github.com/schmitthub/clawker

version: "1"
project: "clawker"

build:
  # Base image for the container
  image: "buildpack-deps:bookworm-scm"
  # Optional: path to custom Dockerfile (relative to project root)
  # dockerfile: "docker/2.1.2/Dockerfile"
  # System packages to install (apt-get on Debian, apk on Alpine)
  packages:
    - git
    - curl
    - ripgrep
    - less
    - procps
    - sudo
    - fzf
    - zsh
    - man-db
    - unzip
    - gnupg2
    - iptables
    - ipset
    - iproute2
    - dnsutils
    - aggregate
    - jq
    - nano
    - vim
    - wget
    - curl
    - gh
    - locales
    - locales-all
    - iputils-ping
  instructions:
    root_run:
      - cmd: |
          ARCH=$(dpkg --print-architecture) && \
            curl -fsSL "https://golang.org/dl/go1.25.5.linux-${ARCH}.tar.gz" | tar -C /usr/local -xzf - \
            && echo 'export PATH=$PATH:/usr/local/go/bin' >> /etc/profile.d/go.sh
    user_run:
      - cmd: curl -LsSf https://astral.sh/uv/install.sh | sh
      - cmd: /usr/local/go/bin/go install golang.org/x/tools/gopls@latest

  inject:
    # after_from: # docker instructions to run after the base image FROM instruction
    # after_packages: # docker instructions to run after installing system packages
    # after_user_setup: # docker instructions to run after creation of the non-root user but before switching to it
    after_user_switch: ENV PATH="$PATH:/usr/local/go/bin:/home/${USERNAME}/go/bin" # docker instructions to run after switching to the non-root user
    after_claude_install: |
      RUN claude mcp add -s local serena -- uvx --from git+https://github.com/oraios/serena serena start-mcp-server --context claude-code --project "$(pwd)" --enable-web-dashboard false
      Run # Currently you can't run docker mcp client connect inside a container due to a check docker does to see if docker desktop is running. see: https://github.com/docker/mcp-gateway/issues/112
        # Install Docker MCP
        # ARG DOCKER_MCP_VERSION=0.35.0
        # RUN ARCH=$(dpkg --print-architecture) && \
        #   mkdir -p /home/node/.docker/cli-plugins && \
        #   curl -fsSL "https://github.com/docker/mcp-gateway/releases/download/v${DOCKER_MCP_VERSION}/docker-mcp-linux-${ARCH}.tar.gz" | tar -C ~/.docker/cli-plugins -xzf - && \
        #   chmod +x /home/node/.docker/cli-plugins/docker-mcp
        # RUN docker mcp client connect claude-code
    # before_entrypoint: # docker instructions to run before the container entrypoint

agent:
  # Files to make available to Claude (prompts, docs, memory)
  # includes:
  #   - "./README.md"
    # - "./.claude/memory.md"
  # Environment variables for the agent
  # editor: "vim"    # defaults to "nano" if not set
  # visual: "vim"    # defaults to "nano" if not set
  env:
    # FOO: bar

workspace:
  # Container path where your code is mounted
  remote_path: "/workspace"
  # Default mode: "bind" (live sync) or "snapshot" (isolated copy)
  default_mode: "bind"

security:
  # Enable network firewall (blocks outbound traffic by default)
  enable_firewall: true
  # Mount Docker socket for Docker-in-Docker (security risk if enabled)
  docker_socket: true
  # Domains allowed through firewall (only when enable_firewall: true)
  # allowed_domains:
  #   - "api.github.com"
  #   - "registry.npmjs.org"
  # Git credential forwarding
  git_credentials:
    forward_https: true
    forward_ssh: true
    copy_git_config: true
